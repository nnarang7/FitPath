<html><head>
	
	<script src ="https://apis.google.com/js/client.js?onload=handleClientLoad"></script>
	<script language="javascript">
		var clientId = '336948298289-fh0p7ls0sj5qs15qtu2d6tgav2dgsm0d.apps.googleusercontent.com';
		var scopes = 'https://www.googleapis.com/auth/calendar.readonly';
		var eventLocations = [];
		var eventTimesStart = [];
		var eventTimesEnd = [];
		var timeDifferences = [];
		function checkAuth() {
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: true}, handleAuthResult);
		}
		function handleAuthResult(authResult) {
	        var authorizeButton = document.getElementById('authorize-button');
	        if (authResult && !authResult.error) {
	          // Hide auth UI, then load client library.
	          authorizeButton.visible = "false";
	          loadCalendarApi();
	        } else {
	          // Show auth UI, allowing the user to initiate authorization by
	          // clicking authorize button.
	          authorizeButton.visible = "true";
	        }
	      }
	      /*
		function handleAuthResult(authResult) {
			var authorizeButton = document.getElementById('authorize-button');
			if (authResult && !authResult.error) {
				authorizeButton.visible = "false";
				makeApiCall();
			}
			else {
				authorizeButton.visible = "true";
				authorizeButton.onclick = handleAuthClick;
			}
		}
		*/
		function handleAuthClick(event) {
			gapi.auth.authorize({client_id: clientId, scope: scopes, immediate: false}, handleAuthResult);
			return false;
		}
		function loadCalendarApi() {
			gapi.client.load('calendar', 'v3', listUpcomingEvents);
		}

		//Use "location": string resource representation to retrieve location
		//https://developers.google.com/google-apps/calendar/v3/reference/events#resource
		//Should be contained in the list response body shown below

		function listUpcomingEvents() {
			var request = gapi.client.calendar.events.list( {
				'calendarId': 'primary',
				'timeMin': (new Date()).toISOString(),
				'showDeleted': false,
				'singleEvents': true,
				'maxResults': 10,
				'orderBy': 'startTime'

			});

			request.execute(function(resp) {
				var events = resp.items;

				appendPre('Upcoming events:');

				if (events.length > 0) {
					for (i = 0; i < events.length; i++) {
              			var event = events[i];
              			var whenS = event.start.dateTime;
              			var whenE = event.end.dateTime;
              			var location = event.location;
            
              			if (!whenS) {
                			whenS = event.start.date;
              			}
              			if (!whenE) {
                			whenE = event.end.date;
              			}
              			appendPre(event.summary + ' (' + whenS + ')');
              			appendPre(event.summary + ' (' + whenE + ')');
              			appendPre(event.summary + ' (' + location + ')');
			
              			eventTimesStart.push(whenS);
              			eventTimesEnd.push(whenE);
              			eventLocations.push(location);
              			calculateTimes();
            		}
				}
				else {
					appendPre('No upcoming events found.');
				}
			});
		}
		function appendPre(message) {
			var pre = document.getElementById('output');
			var textContent = document.createTextNode(message + '\n');
			pre.appendChild(textContent);
		}
		function calculateTimes() {
			for(i = 0; i < (eventTimesStart.length - 1); i++) {
				timeDifferences.push(dateTimeDifference(eventTimesEnd[i], eventTimesStart[i + 1]));
			}
		}
		/*
		Write conditionals for date vs dateTime inputs
		*/
		function dateTimeDifference(date1, date2) {
			if ((typeof date1 == 'Date') && (typeof date2 == 'Date')) {
			    var date1_ms = date1.getTime();
			    var date2_ms = date2.getTime();
			    var difference_ms = date2_ms - date1_ms;
			    //Returns number of minutes
			    console.log(Math.floor(Math.floor(difference_ms % 60) % 60));
			    return Math.floor(Math.floor(difference_ms % 60) % 60);	
			}
			else {
			    var d1 = new Date(date1);
			    var d2 = new Date(date2);
			    var date1_ms = d1.getTime();
			    var date2_ms = d2.getTime();
			    console.log("Time 1: " + date1_ms);
			    console.log("Time 2: " + date2_ms);
			    var difference_ms = date2_ms - date1_ms;
			    console.log(Math.floor(Math.floor(difference_ms % 60) % 60));
			    //Returns number of minutes
			    return Math.floor(Math.floor(difference_ms % 60) % 60);
			}
		}

	</script> </head>
	<body>
		<button id ="authorize-button" visible = "true" onclick = handleAuthClick(event)>Authorize </button>
		<pre id = "output"></pre>
	</body>
</html>
